name: Deploy to Amazon EC2

on:
  push:
    branches: [ "master" ]

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    environment: production

    steps:
    - name: Checkout
      uses: actions/checkout@v3
      
    - name: Docker Login
      run:
        docker login -u wenzellopes -p Darth@31101998
    - name: Docker Push
      run:
        docker image build -t docker-chat-final:latest .
        docker tag docker-chat-final:latest wenzellopes/docker-chat
        docker push wenzellopes/docker-chat:latest
        
    - name: Deploy to Staging server
      uses: easingthemes/ssh-deploy@main
      env:
        SSH_PRIVATE_KEY: ${{ secrets.PEM }}
        REMOTE_HOST: ${{ secrets.HOST_DNS }}
        REMOTE_USER: ${{ secrets.USERNAME_EC2 }}
        TARGET: ${{ secrets.TARGET_DIR }}

   
